!function(){const e={cart:[],favorites:[],step:1,shippingMethod:null,paymentMethod:null,loading:!1,searchQuery:"",currentFilters:{category:"todos",priceRange:"all",material:"all",sortBy:"featured"}},t={};let a=null,n=[];function i(e,t=document){return t.querySelector(e)}function r(e,t=document){return Array.from(t.querySelectorAll(e))}function o(e){return"‚Ç¨"+Number(e).toFixed(2)}function s(){const t=i("#searchInput");t&&(e.searchQuery=t.value.toLowerCase().trim(),c(),function(e){const t=i("#currentSection");t&&(t.textContent=e)}(e.searchQuery?`B√∫squeda: "${e.searchQuery}"`:"Productos"))}function c(){n.forEach(t=>{let a=!0;if(e.searchQuery){const n=(t.name+" "+t.description).toLowerCase();a=a&&n.includes(e.searchQuery)}if("todos"!==e.currentFilters.category&&(a=a&&t.category===e.currentFilters.category),"all"!==e.currentFilters.priceRange){const[n,i]=e.currentFilters.priceRange.split("-").map(Number);a=i?a&&t.price>=n&&t.price<=i:a&&t.price>=n}"all"!==e.currentFilters.material&&(a=a&&t.material===e.currentFilters.material),t.element.style.display=a?"block":"none",a&&t.element.classList.add("reveal")}),function(){const t=i(".product-grid");if(!t)return;const a=n.filter(e=>"none"!==e.element.style.display);a.sort((t,a)=>{switch(e.currentFilters.sortBy){case"price-low":return t.price-a.price;case"price-high":return a.price-t.price;case"rating":return a.rating-t.rating;case"newest":return Math.random()-.5;default:return 0}}),a.forEach(e=>{t.appendChild(e.element)})}()}function l(){r(".product-card").forEach(e=>{const t=i(".quick-view-btn",e);t&&t.addEventListener("click",t=>{t.stopPropagation(),function(e){const t=document.createElement("div");t.className="quick-view-modal",t.innerHTML=`\n      <div class="modal-overlay"></div>\n      <div class="modal-content">\n        <button class="modal-close">&times;</button>\n        <div class="quick-view-content">\n          ${e.innerHTML}\n          <div class="quick-view-actions">\n            <button class="btn-primary">Agregar al Carrito</button>\n            <button class="btn-secondary">Ver Detalles</button>\n          </div>\n        </div>\n      </div>\n    `,document.body.appendChild(t),t.classList.add("active"),t.addEventListener("click",e=>{(e.target.classList.contains("modal-overlay")||e.target.classList.contains("modal-close"))&&d(t)}),document.addEventListener("keydown",function e(a){"Escape"===a.key&&(d(t),document.removeEventListener("keydown",e))})}(e)});const a=i(".favorite-btn",e);a&&a.addEventListener("click",t=>{t.stopPropagation(),u(e)});const n=parseFloat(e.dataset.rating);n&&function(e,t){const a=i(".stars",e);if(!a)return;const n=Math.floor(t),r=t%1>=.5,o=5-n-(r?1:0);a.innerHTML="‚òÖ".repeat(n)+(r?"‚òÜ":"")+"‚òÜ".repeat(o)}(e,n)})}function d(e){e.classList.remove("active"),setTimeout(()=>e.remove(),300)}function u(t){const a=i(".favorite-btn",t),n=i("h3",t)?.textContent;if(a.classList.contains("active"))a.classList.remove("active"),a.innerHTML="‚ô°",e.favorites=e.favorites.filter(e=>e.name!==n);else{a.classList.add("active"),a.innerHTML="‚ô•";const r={name:n,price:i(".current-price",t)?.textContent,image:i(".product-image",t)?.src};e.favorites.push(r)}p(),localStorage.setItem("ihara-london-state",JSON.stringify({cart:e.cart,favorites:e.favorites}))}function p(){const t=i(".favorites-count");t&&(t.textContent=e.favorites.length)}function m(){try{const t=localStorage.getItem("ihara-london-state");if(t){const a=JSON.parse(t);e.cart=a.cart||[],e.favorites=a.favorites||[],p()}}catch(e){}}function m(){try{const t=JSON.parse(localStorage.getItem("ihara_cart")||"[]"),a=JSON.parse(localStorage.getItem("ihara_favorites")||"[]");Array.isArray(t)&&(e.cart=t.map(e=>({...e}))),Array.isArray(a)&&(e.favorites=a.map(e=>({...e}))),p(),h(),b()}catch(e){}}function v(){try{localStorage.setItem("ihara_cart",JSON.stringify(e.cart)),localStorage.setItem("ihara_favorites",JSON.stringify(e.favorites))}catch(e){}}function f(){try{return JSON.parse(localStorage.getItem("ihara_last_sizes")||"{}")}catch(e){return{}}}function l(){const e=["XS","S","M","L","XL"],t=f();r(".product-card").forEach((a,n)=>{if(a.dataset.enhanced)return;const i=a.querySelector("h3")?.textContent?.trim()||`Producto ${n+1}`,o=a.querySelector(".product-price, .price"),s=o?parseFloat(o.textContent.replace(/[^0-9.,]/g,"").replace(",",".")):0,c=a.querySelector("img")?.src||"",l=a.querySelector(".product-info")||a,d=a.querySelector(".product-image")||a;if(!l.querySelector(".size-select-input")){const a=document.createElement("div");a.className="product-size-select";const n=function(e=""){return e.toLowerCase().normalize("NFD").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}(i);a.innerHTML=`<label class="size-label" style="font-size:.6rem;font-weight:600;letter-spacing:.5px;text-transform:uppercase;display:inline-flex;align-items:center;gap:.4rem;">Talle<select aria-label="Seleccionar talle para ${P(i)}" class="size-select-input" data-product-slug="${n}" style="padding:.4rem .55rem;border:1px solid var(--light-brown);border-radius:8px;font-size:.65rem;">${e.map(e=>`<option value="${e}">${e}</option>`).join("")}</select><button type="button" class="size-guide-link" data-open-size-guide title="Gu√≠a de talles" style="background:none;border:none;color:var(--gold-accent);cursor:pointer;font-size:.65rem;font-weight:600;letter-spacing:.5px;">Gu√≠a</button></label>`;const r=l.querySelector(".add-to-cart");r?l.insertBefore(a,r):l.appendChild(a);const o=a.querySelector(".size-select-input");t[n]&&(o.value=t[n]),o.addEventListener("change",()=>{const e=f();e[n]=o.value,function(e){try{localStorage.setItem("ihara_last_sizes",JSON.stringify(e))}catch(e){}}(e)})}let p=l.querySelector(".add-to-cart");p||(p=document.createElement("button"),p.type="button",p.className="add-to-cart",p.innerHTML="<span>Agregar al Carrito</span>",l.appendChild(p)),p.addEventListener("click",()=>{const t=function(e){const t=e.querySelector(".color-option.active");if(!t)return null;const a=Array.from(t.classList).find(e=>e.startsWith("color-"))||"",n=a?a.replace("color-","").replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Color";return{className:a,label:n}}(a),o=function(e){const t=e.querySelector(".size-select-input");if(t)return t.value;const a=e.querySelector(".size-option.active");return a?a.textContent.trim():null}(a);if(a.querySelector(".size-select-input")&&!o)return A("Selecciona un talle"),void a.querySelector(".size-select-input")?.focus();const l=r(".color-option",a).map(e=>{const t=Array.from(e.classList).find(e=>e.startsWith("color-"))||"",a=e.dataset.label||t.replace("color-","").replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase());return{className:t,label:a}});y({id:g(a,n),name:i,price:s,image:c,color:t,size:o,availableColors:l,availableSizes:e})});let m=a.querySelector(".favorite-btn");m?m.parentElement.classList.contains("product-image")||d.appendChild(m):(m=document.createElement("button"),m.type="button",m.className="favorite-btn",m.setAttribute("aria-label","Agregar a favoritos"),m.innerHTML="‚ù§",d.appendChild(m)),m.addEventListener("click",()=>u({id:g(a,n),name:i,price:s,image:c})),a.dataset.enhanced="1"})}function g(e,t){if(e.dataset.pid)return Number(e.dataset.pid);const a=Date.now()+t+Math.floor(1e3*Math.random());return e.dataset.pid=a,a}function u(t){const a=e.favorites.findIndex(e=>e.id===t.id);if(a>-1)e.favorites.splice(a,1),A("Quitado de favoritos");else{const a=document.querySelector(`.product-card[data-pid='${t.id}']`);let n=[],i=null,o=[],s=null;if(a){n=r(".color-option",a).map(e=>{const t=Array.from(e.classList).find(e=>e.startsWith("color-"))||"",a=e.dataset.label||t.replace("color-","").replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase());return e.classList.contains("active")&&(i={className:t,label:a}),{className:t,label:a}}),o=r(".size-option",a).map(e=>e.textContent.trim());const e=a.querySelector(".size-option.active");e&&(s=e.textContent.trim())}e.favorites.push({...t,colors:n,selectedColor:i,sizes:o,selectedSize:s}),A("Agregado a favoritos")}b(),h(),p(),v()}function h(){r(".product-card").forEach(t=>{const a=Number(t.dataset.pid),n=e.favorites.some(e=>e.id===a),i=t.querySelector(".favorite-btn");if(i){const e=i.classList.contains("active");i.classList.toggle("active",n),i.style.color=n?"var(--primary-black)":"var(--gold-accent)",n&&!e&&(i.classList.add("pulse"),setTimeout(()=>i.classList.remove("pulse"),650))}})}function b(){t.favoritesItems&&(t.favoritesItems.innerHTML="");const a=i("#favoritesGrid"),n=i("#favoritesEmpty");if(a&&(a.innerHTML=""),!e.favorites.length)return n&&(n.style.display="block"),void(t.favoritesItems&&(t.favoritesItems.innerHTML='<div class="empty-cart">Sin favoritos</div>'));n&&(n.style.display="none"),e.favorites.forEach(e=>{const n=document.createElement("div");n.className="cart-item";const i=e.colors&&e.colors.length?`<div class='favorites-color-options'>${e.colors.map(t=>`<span class="color-option ${t.className} ${e.selectedColor&&e.selectedColor.className===t.className?"active":""}" data-color="${t.className}" data-label="${P(t.label)}"></span>`).join("")}</div>`:"",r=e.sizes&&e.sizes.length?`<div class='favorites-size-select'><label style='font-size:.55rem;letter-spacing:.5px;font-weight:600;text-transform:uppercase;'>Talle <select class="fav-size-select" style='padding:.3rem .4rem;border:1px solid var(--light-brown);border-radius:6px;font-size:.6rem;'>${e.sizes.map(t=>`<option value="${t}" ${e.selectedSize===t?"selected":""}>${t}</option>`).join("")}</select></label></div>`:"";if(n.innerHTML=`<div class="cart-item-details"><div class="cart-item-title">${P(e.name)}</div><div class="cart-item-price">${o(e.price)}</div>${i}${r}<div class="quantity-controls"><button data-act="add" title="A√±adir al carrito">üõí</button><button data-act="remove" class="remove-item" title="Quitar">‚úï</button></div></div>`,n.querySelector('[data-act="add"]').addEventListener("click",()=>y({...e,color:e.selectedColor||null,size:e.selectedSize||n.querySelector(".fav-size-select")?.value||null})),n.querySelector('[data-act="remove"]').addEventListener("click",()=>u(e)),n.querySelectorAll(".favorites-color-options .color-option").forEach(t=>{t.addEventListener("click",()=>{const a=t.dataset.color,i=t.dataset.label||a;e.selectedColor={className:a,label:i},n.querySelectorAll(".favorites-color-options .color-option").forEach(e=>e.classList.toggle("active",e===t))})}),n.querySelector(".fav-size-select")?.addEventListener("change",t=>{e.selectedSize=t.target.value}),t.favoritesItems?.appendChild(n),a){const t=document.createElement("div");t.className="product-card reveal",t.dataset.pid=e.id,t.innerHTML=`<div class="product-image"><button class="favorite-btn active" aria-label="Quitar">‚ù§</button>${e.image?`<img src="${e.image}" alt="${P(e.name)}"/>`:""}</div><div class="product-info"><h3>${P(e.name)}</h3><div class="product-price">${o(e.price)}</div><button class="add-to-cart" title="A√±adir al carrito"><span>üõí</span></button></div>`,t.querySelector(".add-to-cart").addEventListener("click",()=>y(e)),t.querySelector(".favorite-btn").addEventListener("click",()=>u(e)),a.appendChild(t)}})}function p(){t.favoritesCount&&(t.favoritesCount.textContent=e.favorites.length)}function y(t){const a=t.color?.className||"",n=t.size||"",i=e.cart.find(e=>e.id===t.id&&(e.color?.className||"")===a&&(e.size||"")===n);i?i.quantity+=1:e.cart.push({...t,quantity:1}),L(),A("Producto agregado"),v()}function L(){if(!t.cartItems)return;t.cartItems.innerHTML="",e.cart.length?e.cart.forEach(a=>{const n=document.createElement("div");n.className="cart-item",n.innerHTML=`<img class="cart-item-img" src="${a.image}" alt="${P(a.name)}"/>\n<div class="cart-item-details">\n  <div class="cart-item-title">${P(a.name)}</div>\n  <div class="cart-item-price">${o(a.price)}</div>\n  <div class="cart-item-variant">${a.color?`<span class="color-option ${a.color.className}" style="width:14px;height:14px;pointer-events:none;display:inline-block;border:1px solid #ccc;border-radius:50%;vertical-align:middle;"></span> <span style="font-size:.65rem;vertical-align:middle;">${P(a.color.label)}</span>`:""}${a.size?` <span class="size-badge" style="background:#eee;border-radius:6px;padding:2px 6px;font-size:.55rem;margin-left:.4rem;">${P(a.size)}</span>`:""}</div>\n  <div class="quantity-controls">\n    <button data-q="-1">-</button><span>${a.quantity}</span><button data-q="1">+</button>\n    <button class="edit-item" title="Editar variantes">‚úé</button><button class="remove-item" title="Eliminar">‚úï</button>\n  </div>\n</div>`,n.querySelector('[data-q="-1"]').addEventListener("click",()=>E(a.id,-1)),n.querySelector('[data-q="1"]').addEventListener("click",()=>E(a.id,1)),n.querySelector(".remove-item").addEventListener("click",()=>{return t=a.id,e.cart=e.cart.filter(e=>e.id!==t),L(),void v();var t}),n.querySelector(".edit-item").addEventListener("click",e=>{e.stopPropagation(),S(a,n)}),n.addEventListener("click",e=>{e.target.closest(".quantity-controls, .variant-editor, .ve-colors, .ve-sizes, .ve-actions")||S(a,n)}),t.cartItems.appendChild(n)}):t.cartItems.innerHTML='<div class="empty-cart">Tu carrito est√° vac√≠o</div>';const a=e.cart.reduce((e,t)=>e+t.price*t.quantity,0);t.cartCount&&(t.cartCount.textContent=e.cart.reduce((e,t)=>e+t.quantity,0)),t.cartTotal&&(t.cartTotal.textContent=o(a)),M()}function E(t,a){const n=e.cart.find(e=>e.id===t);n&&(n.quantity+=a,n.quantity<=0&&(e.cart=e.cart.filter(e=>e.id!==t)),L(),v())}function S(t,a){if(a.querySelector(".variant-editor"))return void a.querySelector(".variant-editor").remove();r(".variant-editor").forEach(e=>e.remove());const n=document.createElement("div");n.className="variant-editor";const i=t.availableColors||t.availablecolors||t.availableColors||[],o=t.availableSizes||t.sizes||[],s=i.length?`<div class='ve-colors'>${i.map(e=>`<span class="color-option ${e.className} ${t.color&&t.color.className===e.className?"active":""}" data-color="${e.className}" title="${P(e.label)}"></span>`).join("")}</div>`:"",c=o.length?`<div class='ve-sizes'><label style='font-size:.55rem;letter-spacing:.5px;font-weight:600;text-transform:uppercase;'>Talle <select class='ve-size-select' aria-label='Editar talle' style='padding:.3rem .5rem;border:1px solid var(--light-brown);border-radius:6px;font-size:.6rem;'>${o.map(e=>`<option value="${e}" ${t.size===e?"selected":""}>${e}</option>`).join("")}</select></label></div>`:"";n.innerHTML=`<div class='ve-inner'>${s}${c}<div class='ve-actions'><button class='ve-save'>Guardar</button><button class='ve-cancel'>Cancelar</button></div></div>`,n.addEventListener("click",e=>{e.stopPropagation()}),a.appendChild(n),n.querySelectorAll(".ve-colors .color-option").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),n.querySelectorAll(".ve-colors .color-option").forEach(e=>e.classList.remove("active")),e.classList.add("active")})});const l=n.querySelector(".ve-size-select");l&&(l.addEventListener("click",e=>{e.stopPropagation()}),l.addEventListener("change",e=>{e.stopPropagation()})),n.querySelector(".ve-cancel").addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),n.remove()}),n.querySelector(".ve-save").addEventListener("click",a=>{a.preventDefault(),a.stopPropagation();const i=n.querySelector(".ve-colors .color-option.active"),r=n.querySelector(".ve-size-select"),o=i?{className:Array.from(i.classList).find(e=>e.startsWith("color-"))||"",label:(i.title||"").trim()}:null,s=r?r.value:null;if((t.color?.className||"")+"|"+(t.size||"")===(o?.className||"")+"|"+(s||""))return void n.remove();const c=e.cart.find(e=>e!==t&&e.id===t.id&&(e.color?.className||"")===(o?.className||"")&&(e.size||"")===(s||""));c?(c.quantity+=t.quantity,e.cart=e.cart.filter(e=>e!==t)):(t.color=o,t.size=s),n.remove(),setTimeout(()=>{L(),v()},10)})}function x(){const e=i(".size-guide-modal");e&&(e.classList.remove("open"),a&&(a.focus(),a=null),document.removeEventListener("keydown",w))}function w(e){"Escape"===e.key&&i(".size-guide-modal.open")&&x()}function C(e){const t=i(".size-table-wrap");if(!t)return;const a=e=>(e/2.54).toFixed(2),n=(t,n,i)=>{if("imperial"===e){return`${a(t[0])}-${a(t[1])} in <small class='alt-unit'>(${t[0]}-${t[1]} ${n})</small>`}return`${t[0]}-${t[1]} ${n} <small class='alt-unit'>(${a(t[0])}-${a(t[1])} in)</small>`};t.innerHTML=`<table class='size-table'>\n      <thead><tr><th>Talle</th><th>Di√°metro Anillo ${"imperial"===e?"(in)":"(mm)"} </th><th>Mu√±eca ${"imperial"===e?"(in)":"(cm)"} </th><th>Collar ${"imperial"===e?"(in)":"(cm)"} </th></tr></thead>\n      <tbody>\n        ${[{size:"XS",ring:[15,15.5],wrist:[13,14],collar:[38,40]},{size:"S",ring:[16,16.5],wrist:[14,15.5],collar:[42,45]},{size:"M",ring:[17,17.5],wrist:[15.5,17],collar:[50,55]},{size:"L",ring:[18,18.5],wrist:[17,18.5],collar:[60,65]},{size:"XL",ring:[19,20],wrist:[18.5,20],collar:[70,75]}].map(e=>`<tr><td>${e.size}</td><td>${n(e.ring,"mm")}</td><td>${n(e.wrist,"cm")}</td><td>${n(e.collar,"cm")}</td></tr>`).join("")}\n      </tbody>\n    </table>`,function(e,t=document){return Array.from(t.querySelectorAll(e))}(".unit-toggle").forEach(t=>t.setAttribute("aria-pressed",t.dataset.unit===("imperial"===e?"imperial":"metric")?"true":"false"))}function k(){t.checkoutModal?.classList.remove("active")}function z(a){e.step=a,r(".checkout-step").forEach(e=>e.classList.toggle("active",Number(e.dataset.step)===a)),function(){if(!t.stepIndicator)return;r("span",t.stepIndicator).forEach(t=>t.classList.toggle("active",Number(t.dataset.step)===e.step))}(),function(){if(!t.prevStep||!t.nextStep)return;t.prevStep.style.visibility=1===e.step?"hidden":"visible",t.nextStep.textContent=4===e.step?"Confirmar Pedido":"Siguiente"}()}document.addEventListener("DOMContentLoaded",function(){t.cartButton=i("#cartButton"),t.cartSidebar=i("#cartSidebar"),t.cartItems=i("#cartItems"),t.cartCount=i(".cart-count"),t.cartTotal=i("#cartTotalAmount"),t.closeCart=i("#closeCart"),t.checkoutBtn=i("#checkoutBtn"),t.checkoutModal=i("#checkoutModal"),t.closeCheckout=i("#closeCheckout"),t.prevStep=i("#prevStep"),t.nextStep=i("#nextStep"),t.summaryItems=i("#summaryItems"),t.summarySubtotal=i("#summarySubtotal"),t.summaryShipping=i("#summaryShipping"),t.summaryTotal=i("#summaryTotal"),t.shippingAddress=i("#shippingAddress"),t.cardForm=i("#cardForm"),t.transferInfo=i("#transferInfo"),t.favoritesButton=i("#favoritesButton"),t.favoritesSidebar=i("#favoritesSidebar"),t.closeFavorites=i("#closeFavorites"),t.favoritesItems=i("#favoritesItems"),t.favoritesCount=i(".favorites-count"),t.stepIndicator=function(){const e=i(".checkout-content .step-indicator");if(e)return e;const t=document.createElement("div");return t.className="step-indicator",["Entrega","Contacto","Pago","Resumen"].forEach((e,a)=>{const n=document.createElement("span");n.dataset.step=a+1,n.innerHTML=`<strong>${a+1}</strong> ${e}`,t.appendChild(n)}),i(".checkout-content")?.insertBefore(t,i(".checkout-steps")),t}(),function(){t.cartButton?.addEventListener("click",()=>t.cartSidebar.classList.add("active")),t.closeCart?.addEventListener("click",()=>t.cartSidebar.classList.remove("active")),t.favoritesButton?.addEventListener("click",()=>t.favoritesSidebar?.classList.add("active")),t.closeFavorites?.addEventListener("click",()=>t.favoritesSidebar?.classList.remove("active")),t.checkoutBtn?.addEventListener("click",()=>{if(!e.cart.length)return A("El carrito est√° vac√≠o");t.checkoutModal?.classList.add("active"),z(1)}),t.closeCheckout?.addEventListener("click",k),t.prevStep?.addEventListener("click",()=>{e.step>1&&z(e.step-1)}),t.nextStep?.addEventListener("click",()=>function(){if(!function(t){switch(function(e){r(`.checkout-step[data-step='${e}'] .field`).forEach(e=>{e.classList.remove("field-error");const t=e.querySelector(".error-msg");t&&t.remove()})}(t),t){case 1:return e.shippingMethod?"delivery"!==e.shippingMethod||(T("#address")||$("#address","Requerido"),T("#city")||$("#city","Requerido"),T("#postalCode")||$("#postalCode","Requerido"),!i('.checkout-step[data-step="1"] .field-error'))||(A("Completa la direcci√≥n"),!1):(A("Selecciona un m√©todo de entrega"),!1);case 2:return T("#name")||$("#name","Requerido"),T("#email")||$("#email","Requerido"),T("#phone")||$("#phone","Requerido"),!i('.checkout-step[data-step="2"] .field-error')||(A("Completa tus datos"),!1);case 3:return e.paymentMethod?"card"!==e.paymentMethod||(T("#cardNumber")||$("#cardNumber","Requerido"),T("#cardExpiry")||$("#cardExpiry","Requerido"),T("#cardCVC")||$("#cardCVC","Requerido"),!i('.checkout-step[data-step="3"] .field-error'))||(A("Datos tarjeta incompletos"),!1):(A("Selecciona m√©todo de pago"),!1);default:return!0}}(e.step))return;e.step<4?z(e.step+1):function(){if(!e.cart.length)return A("Carrito vac√≠o");N(!0),setTimeout(()=>{N(!1);!function(){const t=e.cart.reduce((e,t)=>e+t.price*t.quantity,0),a="delivery"===e.shippingMethod?500:0;e.cart,e.shippingMethod,"delivery"===e.shippingMethod&&(T("#address"),T("#city"),T("#postalCode")),T("#name"),T("#email"),T("#phone"),e.paymentMethod,"card"===e.paymentMethod&&(T("#cardNumber")||"").slice(-4),(new Date).toISOString()}();A("¬°Pedido confirmado!"),e.cart=[],L(),k()},1200)}()}()),r('input[name="shipping"]').forEach(a=>a.addEventListener("change",a=>{e.shippingMethod=a.target.value,function(){if(!t.shippingAddress)return;t.shippingAddress.classList.toggle("hidden","delivery"!==e.shippingMethod)}(),M()})),r('input[name="payment"]').forEach(a=>a.addEventListener("change",a=>{e.paymentMethod=a.target.value,function(){t.cardForm&&t.cardForm.classList.toggle("hidden","card"!==e.paymentMethod);t.transferInfo&&t.transferInfo.classList.toggle("hidden","transfer"!==e.paymentMethod)}()}));const a=i("#navToggle"),n=i(".nav-links");a?.addEventListener("click",()=>{const e=n.classList.toggle("open");a.classList.toggle("active",e),a.setAttribute("aria-expanded",e?"true":"false")}),n?.querySelectorAll("a").forEach(e=>e.addEventListener("click",()=>{window.innerWidth<880&&(n.classList.remove("open"),a?.classList.remove("active"),a?.setAttribute("aria-expanded","false"))}));const o=i("#themeToggle");"dark"===localStorage.getItem("ihara_theme")&&document.body.classList.add("dark");o?.addEventListener("click",()=>{document.body.classList.toggle("dark"),localStorage.setItem("ihara_theme",document.body.classList.contains("dark")?"dark":"light")})}(),l(),r('a[href^="#"]').forEach(e=>{e.addEventListener("click",t=>{const a=e.getAttribute("href");if(a&&a.startsWith("#")&&a.length>1){const e=i(a);e&&(t.preventDefault(),e.scrollIntoView({behavior:"smooth"}))}})}),b(),m(),r(".product-card").forEach(e=>{const t=r(".color-option",e);t.forEach(e=>{if(!e.dataset.label){const t=Array.from(e.classList).find(e=>e.startsWith("color-"))||"";e.dataset.label=t.replace("color-","").replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase())}e.addEventListener("click",()=>{t.forEach(e=>e.classList.remove("active")),e.classList.add("active")})})}),r(".product-card").forEach(e=>{const t=r(".size-option",e);t.forEach(e=>{e.addEventListener("click",()=>{t.forEach(e=>e.classList.remove("active")),e.classList.add("active")})}),t.length&&!e.querySelector(".size-option.active")&&t[0].classList.add("active")}),document.body.addEventListener("click",e=>{e.target.closest("[data-open-size-guide]")&&function(){let e=i(".size-guide-modal");e||(e=document.createElement("div"),e.className="size-guide-modal",e.innerHTML="<div class='size-guide-dialog' role='dialog' aria-modal='true' aria-labelledby='sizeGuideTitle'>\n        <button class='sg-close' data-close-size-guide aria-label='Cerrar gu√≠a'>&times;</button>\n        <h3 id='sizeGuideTitle' tabindex='-1'>Gu√≠a de Talles</h3>\n        <p style='font-size:.75rem;line-height:1.4;'>Selecciona el talle que mejor se ajuste. Si est√°s entre dos talles, recomendamos elegir el mayor para mayor comodidad.</p>\n        <div class='size-guide-toolbar'>\n          <button type='button' class='unit-toggle' data-unit='metric' aria-pressed='true'>CM / MM</button>\n          <button type='button' class='unit-toggle' data-unit='imperial' aria-pressed='false'>INCH</button>\n          <div class='ring-converter' aria-label='Conversor de circunferencia a talle'>\n            <label style='font-size:.55rem;letter-spacing:.5px;font-weight:600;text-transform:uppercase;'>Circunferencia\n              <input type='number' min='0' step='0.01' class='ring-circ-input' placeholder='mm o in'>\n            </label>\n            <select class='ring-circ-unit'>\n              <option value='mm'>mm</option>\n              <option value='in'>inch</option>\n            </select>\n            <button class='ring-calc' type='button'>Calcular</button>\n            <span class='ring-result' aria-live='polite'></span>\n          </div>\n        </div>\n        <div class='size-table-wrap'></div>\n        <small style='opacity:.7;display:block;margin-top:.8rem;'>Medidas orientativas. Para precisi√≥n usa una cinta flexible.</small>\n      </div>",document.body.appendChild(e)),e.classList.add("open"),a=document.activeElement instanceof HTMLElement?document.activeElement:null,C("metric"),function(e){e.dataset.bound||(e.dataset.bound="1",e.addEventListener("click",e=>{const t=e.target.closest(".unit-toggle");t&&C("imperial"===t.dataset.unit?"imperial":"metric"),e.target.classList.contains("ring-calc")&&function(){const e=i(".ring-circ-input"),t=i(".ring-circ-unit"),a=i(".ring-result");if(!e||!t||!a)return;let n=parseFloat(e.value);if(!n)return void(a.textContent="");"in"===t.value&&(n*=25.4);const r=n/Math.PI,o=[{size:"XS",min:15,max:15.5},{size:"S",min:16,max:16.5},{size:"M",min:17,max:17.5},{size:"L",min:18,max:18.5},{size:"XL",min:19,max:20}];let s=o.find(e=>r>=e.min&&r<=e.max);s||(r<15?s=o[0]:r>20&&(s=o[o.length-1])),a.textContent=`‚âà di√°metro ${r.toFixed(2)} mm ‚Üí Talle sugerido: ${s?.size||"?"}`}()}))}(e),setTimeout(()=>i("#sizeGuideTitle")?.focus(),20),function(e){if(!e)return;const t='a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])',a=Array.from(e.querySelectorAll(t)).filter(e=>!e.hasAttribute("disabled"));if(!a.length)return;const n=a[0],i=a[a.length-1];e.addEventListener("keydown",e=>{"Tab"===e.key&&(e.shiftKey&&document.activeElement===n?(e.preventDefault(),i.focus()):e.shiftKey||document.activeElement!==i||(e.preventDefault(),n.focus()))})}(e.querySelector(".size-guide-dialog")),document.addEventListener("keydown",w)}(),e.target.matches(".size-guide-modal [data-close-size-guide]")&&x(),e.target.classList.contains("size-guide-modal")&&x()}),function(){const e=document.querySelector(".newsletter-form");if(!e)return;let t=e.querySelector(".newsletter-status");t||(t=document.createElement("div"),t.className="newsletter-status",t.setAttribute("aria-live","polite"),t.style.fontSize=".7rem",t.style.width="100%",e.appendChild(t));function a(e,a){t.textContent=e,t.style.color=a?"#ff6b6b":"var(--gold-accent)"}e.addEventListener("submit",t=>{t.preventDefault();const n=e.querySelector('input[type="email"]');if(!n)return;const i=n.value.trim();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i))return a("Ingresa un correo v√°lido",!0),void n.focus();const r=function(){try{return JSON.parse(localStorage.getItem("ihara_subscribers")||"[]")}catch(e){return[]}}();if(r.includes(i.toLowerCase()))return void a("Ya est√°s suscripto",!1);if((window.NEWSLETTER_ENDPOINT||"").includes("/subscribe")){r.push(i.toLowerCase()),H(r),a("Revisa tu correo para confirmar la suscripci√≥n.",!1);const t=e.querySelector('button[type="submit"]');t&&(t.disabled=!0,t.textContent="Pendiente"),F(i,null,{doubleOptIn:!0})}else{r.push(i.toLowerCase()),H(r),a("¬°Suscripci√≥n exitosa! Revisa tu bandeja.",!1),n.disabled=!0;const t=e.querySelector('button[type="submit"]');t&&(t.disabled=!0,t.textContent="Suscripto");const o=function(e){const t=e.split("@")[0].replace(/[^a-zA-Z0-9._-]+/g," ").trim(),a=t?t.charAt(0).toUpperCase()+t.slice(1):"Cliente",n=(new Date).getFullYear();return`<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><title>Bienvenida Ihara & London</title><meta name="viewport" content="width=device-width,initial-scale=1"/><style>body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#0d0d0d;color:#f5f5f5;}a{color:#d4af37;text-decoration:none;} .hero{background:linear-gradient(135deg,#111,#1d1d1d);padding:40px 25px;text-align:center;}h1{font-size:28px;margin:0;background:linear-gradient(45deg,#fff,#d4af37);-webkit-background-clip:text;color:transparent;}p{line-height:1.55;font-size:14px;margin:16px 0;} .card{max-width:620px;margin:0 auto;background:#181818;border:1px solid #2a2a2a;border-radius:18px;overflow:hidden;box-shadow:0 6px 22px -8px rgba(0,0,0,.6);} .content{padding:10px 28px 40px;} .badge{display:inline-block;background:#d4af37;color:#111;font-weight:600;padding:6px 14px;border-radius:30px;font-size:11px;letter-spacing:.5px;} .cta{display:inline-block;margin-top:22px;background:#d4af37;color:#111;padding:14px 26px;font-weight:600;border-radius:40px;font-size:13px;letter-spacing:.8px;} .grid{display:flex;flex-wrap:wrap;gap:14px;margin:28px 0 10px;} .grid-item{flex:1 1 160px;background:#202020;border:1px solid #2c2c2c;border-radius:14px;padding:14px 16px;min-width:150px;} .grid-item h3{margin:0 0 6px;font-size:15px;color:#fff;} .grid-item span{font-size:12px;opacity:.75;} footer{font-size:11px;opacity:.65;padding:24px 10px;text-align:center;} hr{border:none;border-top:1px solid #2e2e2e;margin:34px 0;} .logo{font-size:13px;font-weight:600;letter-spacing:2px;text-transform:uppercase;color:#d4af37;margin:0;} @media(max-width:520px){h1{font-size:24px;} .content{padding:0 22px 34px;} .grid{flex-direction:column;} .grid-item{min-width:auto;} }</style></head><body><div class="card"><div class="hero"><p class="logo">Ihara & London</p><h1>Bienvenida, ${a}</h1><div class="badge">EXPERIENCIA EXCLUSIVA</div></div><div class="content"><p>Gracias por unirte a nuestra lista privada. A partir de ahora recibir√°s acceso temprano a lanzamientos, ediciones limitadas y recomendaciones seleccionadas para tu estilo.</p><p>Cuidamos cada detalle como si fuera √∫nico. Este es el comienzo de algo especial.</p><div class="grid"><div class="grid-item"><h3>Acceso Anticipado</h3><span>Nuevas colecciones antes que nadie.</span></div><div class="grid-item"><h3>Ediciones Limitadas</h3><span>Piezas con disponibilidad reducida.</span></div><div class="grid-item"><h3>Gu√≠as Personalizadas</h3><span>Consejos de estilo y cuidado.</span></div></div><a class="cta" href="https://www.instagram.com/ihara_calzado?igsh=MXhsaXJhcTI4djg2Mg==" target="_blank" rel="noopener">S√≠guenos</a><hr><p style="font-size:12px;opacity:.7;">Si no solicitaste esta suscripci√≥n puedes ignorar este correo.</p><p style="font-size:12px;opacity:.55;">&copy; ${n} Ihara & London. Todos los derechos reservados.</p></div></div><footer>Enviado autom√°ticamente ‚Ä¢ No responder</footer></body></html>`}(i);!function(e){let t=document.querySelector(".email-preview-modal");t||(t=document.createElement("div"),t.className="email-preview-modal",t.innerHTML="<div class='ep-dialog' role='dialog' aria-modal='true' aria-labelledby='epTitle'>\n        <button class='ep-close' aria-label='Cerrar'>&times;</button>\n        <h3 id='epTitle'>Correo de Bienvenida (Vista Previa)</h3>\n        <div class='ep-actions'>\n          <button type='button' data-ep-copy>Copiar HTML</button>\n          <button type='button' data-ep-download>Descargar .html</button>\n          <button type='button' data-ep-close>Cerrar</button>\n        </div>\n        <iframe class='ep-frame' title='Vista previa email'></iframe>\n        <small style='display:block;margin-top:8px;opacity:.65;'>Esta es una simulaci√≥n local. Para env√≠o real configura un servicio (ej: EmailJS, SendGrid, etc.).</small>\n      </div>",document.body.appendChild(t));t.classList.add("open");const a=t.querySelector(".ep-frame");if(a){const t=a.contentDocument||a.contentWindow?.document;t&&(t.open(),t.write(e),t.close())}t.querySelector(".ep-close")?.addEventListener("click",()=>t.classList.remove("open")),t.querySelector("[data-ep-close]")?.addEventListener("click",()=>t.classList.remove("open")),t.querySelector("[data-ep-copy]")?.addEventListener("click",()=>{navigator.clipboard?.writeText(e),A("HTML copiado")}),t.querySelector("[data-ep-download]")?.addEventListener("click",()=>{const t=new Blob([e],{type:"text/html"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download="bienvenida-ihara-london.html",document.body.appendChild(a),a.click(),a.remove(),setTimeout(()=>URL.revokeObjectURL(a.href),2e3)})}(o),function(e,t){const a=window.NEWSLETTER_EMAILJS;if(!window.emailjs||!a)return;try{window.emailjs.init(a.publicKey);const n={},i=a.fieldMap||{to_email:"to_email",message_html:"message_html"};n[i.to_email]=e,n[i.message_html]=t,window.emailjs.send(a.serviceId,a.templateId,n).then(()=>{A("Email enviado (EmailJS)")}).catch(()=>{})}catch(e){}}(i,o),F(i,o)}})}(),function(){const e=i("#searchInput"),t=i("#searchButton");e&&(e.addEventListener("input",function(e,t){let a;return function(...n){const i=()=>{clearTimeout(a),e(...n)};clearTimeout(a),a=setTimeout(i,t)}}(s,300)),e.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),s())}));t&&t.addEventListener("click",s)}(),function(){const t=i("#priceRange"),a=i("#sortBy"),n=i("#material");[t,a,n].forEach(t=>{t&&t.addEventListener("change",t=>{e.currentFilters[t.target.id]=t.target.value,c()})})}(),function(){const e=new IntersectionObserver(e=>{const t=i(".breadcrumb-nav");if(!t)return;const a=e.find(e=>"home"===e.target.id);a&&(t.style.display=a.isIntersecting?"none":"block")},{threshold:.1});r("section[id]").forEach(t=>e.observe(t))}(),L(),z(1),n=r(".product-card").map(e=>({element:e,name:i("h3",e)?.textContent||"",price:parseFloat(e.dataset.price)||0,category:e.dataset.category||"",material:e.dataset.material||"",rating:parseFloat(e.dataset.rating)||0,description:i(".product-description",e)?.textContent||""})),function(){const e=r(".faq-category-btn"),t=r(".faq-category-content");e.forEach(a=>{a.addEventListener("click",()=>{const n=a.dataset.category;e.forEach(e=>e.classList.remove("active")),t.forEach(e=>e.classList.remove("active")),a.classList.add("active");const r=i(`[data-category="${n}"].faq-category-content`);r&&r.classList.add("active")})});r(".faq-question").forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".faq-item"),a=t.classList.contains("active"),n=t.closest(".faq-category-content");n&&n.querySelectorAll(".faq-item").forEach(e=>{e.classList.remove("active")}),a||t.classList.add("active")})})}(),function(){r(".blog-link").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),A("Art√≠culo completo disponible pr√≥ximamente")})});const e=i(".view-all-btn");e&&e.addEventListener("click",e=>{e.preventDefault(),A("Blog completo disponible pr√≥ximamente")})}(),r('a[href^="#"]').forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const a=e.getAttribute("href").substring(1),n=document.getElementById(a);if(n){const e=i(".header")?.offsetHeight||80,t=n.offsetTop-e;window.scrollTo({top:t,behavior:"smooth"});const a=i(".hamburger"),r=i(".nav-links");a&&r&&a.classList.contains("active")&&(a.classList.remove("active"),r.classList.remove("active"))}})}),function(){const e=i("#contactForm"),t=i("#inlineContactForm");e&&e.addEventListener("submit",O);t&&t.addEventListener("submit",_)}(),j()}),window.addToCart=y,window.updateQuantity=E;const q=z;function T(e){const t=i(e);return t&&t.value.trim()}function $(e,t){const a=i(e);if(!a)return;const n=a.closest(".field");if(n&&(n.classList.add("field-error"),!n.querySelector(".error-msg"))){const e=document.createElement("div");e.className="error-msg",e.textContent=t,n.appendChild(e)}}function M(){if(!t.summaryItems)return;t.summaryItems.innerHTML="";let a=0;e.cart.forEach(e=>{const n=e.price*e.quantity;a+=n;const i=[];e.color&&i.push(e.color.label),e.size&&i.push("Talle "+e.size);const r=i.length?" ("+i.join(" / ")+")":"",s=document.createElement("div");s.className="summary-line",s.innerHTML=`<span>${P(e.name)}${r} x${e.quantity}</span><span>${o(n)}</span>`,t.summaryItems.appendChild(s)});const n="delivery"===e.shippingMethod?500:0;t.summarySubtotal&&(t.summarySubtotal.textContent=o(a)),t.summaryShipping&&(t.summaryShipping.textContent=o(n)),t.summaryTotal&&(t.summaryTotal.textContent=o(a+n))}function N(a){e.loading=a,t.nextStep?.classList.toggle("loading",a),a?(t.nextStep.dataset.prevText=t.nextStep.textContent,t.nextStep.innerHTML='<span class="spinner"></span>',t.nextStep.disabled=!0):(t.nextStep.disabled=!1,t.nextStep.textContent=t.nextStep.dataset.prevText||"Siguiente")}let I;function A(e){let t=i(".notification");t||(t=document.createElement("div"),t.className="notification",document.body.appendChild(t)),t.textContent=e,t.classList.add("show"),clearTimeout(I),I=setTimeout(()=>t.classList.remove("show"),3e3)}function P(e=""){return e.replace(/[&<>"]+/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[e]))}function H(e){try{localStorage.setItem("ihara_subscribers",JSON.stringify(e))}catch(e){}}function F(e,t,a={}){const n=window.NEWSLETTER_ENDPOINT;if(!n)return;const i={"Content-Type":"application/json"};window.NEWSLETTER_API_TOKEN&&(i["x-api-token"]=window.NEWSLETTER_API_TOKEN);const r=document.querySelector(".newsletter-form"),o=r?.querySelector('button[type="submit"]');o&&(o.disabled=!0,o.textContent="Enviando...");const s=a.doubleOptIn?{email:e}:{email:e,html:t};fetch(n,{method:"POST",headers:i,body:JSON.stringify(s)}).then(async e=>{let t=null;try{t=await e.json()}catch{}if(!e.ok)throw new Error(t?.error||"Error");a.doubleOptIn?t?.duplicate&&t?.confirmed?A("Ya confirmado (backend)"):t?.duplicate?A("Pendiente de confirmaci√≥n (ya solicitado)"):t?.pending&&A("Correo de confirmaci√≥n enviado"):A(t?.duplicate?"Ya estaba suscripto (backend)":"Email enviado (backend)")}).catch(e=>{A("No se pudo contactar el servidor")}).finally(()=>{o&&(o.disabled=!0,a.doubleOptIn?o.textContent="Pendiente":o.textContent="Suscripto")})}async function O(e){e.preventDefault();const t=e.target,a=new FormData(t),n=t.querySelector(".contact-submit-btn"),i=n.innerHTML;n.innerHTML='<span class="btn-text">Enviando...</span><span class="btn-icon">‚è≥</span>',n.disabled=!0;try{const e=await fetch("/api/contact/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a.get("name"),email:a.get("email"),subject:a.get("subject"),message:a.get("message"),newsletter:"1"===a.get("newsletter")})}),n=await e.json();if(!e.ok)throw new Error(n.error||"Error en el servidor");A("¬°Mensaje enviado exitosamente! Te responderemos pronto."),t.reset(),a.get("newsletter")&&setTimeout(()=>{A("Tambi√©n te has suscrito a nuestro newsletter")},1500)}catch(e){A("Error al enviar el mensaje. Por favor intenta nuevamente.")}finally{setTimeout(()=>{n.innerHTML=i,n.disabled=!1},1e3)}}async function _(e){e.preventDefault();const t=e.target,a=new FormData(t),n=t.querySelector(".inline-submit-btn"),i=n.innerHTML;n.innerHTML='<span>Enviando...</span><span class="btn-icon">‚è≥</span>',n.disabled=!0;try{const e=await fetch("/api/contact/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a.get("name")||t.querySelector('input[type="text"]').value,email:a.get("email")||t.querySelector('input[type="email"]').value,subject:"Consulta desde formulario inline",message:a.get("message")||t.querySelector("textarea").value,newsletter:!1})}),n=await e.json();if(!e.ok)throw new Error(n.error||"Error en el servidor");A("¬°Consulta enviada! Nos pondremos en contacto contigo pronto."),t.reset()}catch(e){A("Error al enviar la consulta. Por favor intenta nuevamente.")}finally{setTimeout(()=>{n.innerHTML=i,n.disabled=!1},1e3)}}function j(){const e=i(".map-placeholder-enhanced"),t=r(".map-link-btn");e&&e.addEventListener("click",()=>{window.open("https://www.google.com/maps/search/Ituzaingo+562,+San+Cristobal,+Santa+Fe,+Argentina","_blank"),A("Abriendo ubicaci√≥n en Google Maps...")}),t.forEach(e=>{e.addEventListener("click",t=>{const a=e.textContent.trim();a.includes("Google Maps")?A("Abriendo en Google Maps..."):a.includes("Apple Maps")&&A("Abriendo en Apple Maps...")})})}z=function(t){q(t),function(){const t=i("#checkoutProgress");if(!t)return;const a=(e.step-1)/3*100;t.style.width=a+"%"}()},window.__notify=A,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",j):j(),window.state=e,window.filterProducts=c}();